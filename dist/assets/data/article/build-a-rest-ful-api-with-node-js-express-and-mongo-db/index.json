{"hash":"29d417bfd348d50c2458ac04087693df422d3bf6","data":{"post":{"title":"Build a RestFul API With Node.js, Express & MongoDB","path":"/article/build-a-rest-ful-api-with-node-js-express-and-mongo-db/","date":"09 Nov 2022","timeToRead":7,"content":"<p>In this detailed tutorial, we will be building a Rest API with <strong>Node.js</strong>, <strong>Express</strong> and <strong>MongoDB</strong> non-relational database. This API will expose endpoints that will allow for <strong>CRUD</strong> (Create, Read, Update, Delete) operations.<br></br></p>\n<h3 id=\"prerequisites\"><a href=\"#prerequisites\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>#Prerequisites</h3>\n<br>\nTo follow along with the tutorial, you'll need to have the following specified tools installed üëá:<br></br>\n<ul>\n<li><a href=\"nodejs.org\">Node</a></li>\n<li>MongoDB Compass</li>\n<li>A text/code editor of your choice</li>\n<li>A terminal\n<br></br></li>\n</ul>\n<p>Also make sure you've mastered fundamentals of the following in order to sail through smoothly:<br></br></p>\n<ul>\n<li>Node</li>\n<li>JavaScript</li>\n<li>MongoDB</li>\n<li>APIs\n<br></br></li>\n</ul>\n<h3 id=\"to-do-lists\"><a href=\"#to-do-lists\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>#To-do lists</h3>\n<br>\n<p>What we are going to build is a Rest API where user details can be stored. Information such as <strong>Email</strong>, <strong>Name</strong>, &#x26; <strong>Phone number</strong> will be stored with each individual user. Since this is a CRUD API, 4 types of endpoint need to be exposed.<br></p>\n<p>First, we will create our <strong>GET</strong> endpoint that will list all user details in our MongoDB database: <br></br></p>\n<pre><code class=\"language-bash\">GET /get\n</code></pre>\n<br>\n<p>We will be starting with an empty database. So, we need to create a <strong>POST</strong> endpoint that will allow us to add user details:<br></br></p>\n<pre><code class=\"language-bash\">POST /add\n</code></pre>\n<br>\n<p>The third endpoint will be the <strong>PATCH</strong> method, this will allow us to update users information when we need to:<br></br></p>\n<pre><code class=\"language-bash\">PATCH /update\n</code></pre>\n<br>\n<p>Finally, we have to create a <strong>DELETE</strong> endpoint incase we have to delete every information about a user:<br></br></p>\n<pre><code class=\"language-bash\">DELETE /remove\n</code></pre>\n<br>\n<p>By making these 4 endpoints, we will achieve our aim to create a CRUD API. Without wasting time further, open up any <strong>terminal</strong> of choice, I will be using <strong>Git bash</strong> terminal.<br></br></p>\n<h3 id=\"creating-our-project\"><a href=\"#creating-our-project\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>#Creating our project</h3>\n<br>\n<p>We will kick off by making a folder called <strong>userApp</strong> for our project. Afterwards, initialize a <strong>package.json</strong> file in the root by typing the <strong>npm init -y</strong> command.<br></br></p>\n<pre><code class=\"language-bash\">Dev.Adewale ~/documents $ mkdir userApp\n\nDev.Adewale ~/documents $ cd userApp\n\nDev.Adewale ~/documents/userApp $ npm init -y\nWrote to C:\\Users\\Adeyemi\\documents\\userApp\\package.json:\n\n{\n  \"name\": \"userapp\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" &#x26;&#x26; exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\"\n}\n</code></pre>\n<p><br></br></p>\n<p>After project initialization, we'll have to install all dependencies that will make it somewhat easy for us to build our API and it's <strong>CRUD</strong> endpoints. So, open your terminal again and install üëá:<br></br></p>\n<pre><code class=\"language-bash\">npm i express mongoose --save\n</code></pre>\n<br>\n<p>We have to install one more package, but to our <strong>devDependencies</strong> this time around:<br></br></p>\n<pre><code class=\"language-bash\">npm i nodemon --save-dev\n</code></pre>\n<br>\n<p>Here's a breakdown of what we installed üïµÔ∏è‚Äç‚ôÇÔ∏è:<br></br></p>\n<h3 id=\"express\"><a href=\"#express\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>#Express</h3>\n<br>\n<p>Express is a fast, minimal and flexible <strong>Node</strong> web application framework. It comes with robust set of features that will allow us spin up our API <strong>Server</strong> without much complexity.\n<br></br></p>\n<h3 id=\"mongoose\"><a href=\"#mongoose\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>#Mongoose</h3>\n<br>\n<p>We installed the <strong>mongoose</strong> package instead of <strong>mongodb</strong> earlier, wondering why? It's because Mongoose is a wrapper package that provides more advanced features than using the MongoDB package.</p>\n<br>\nMongoose is an Object Data Modeling (ODM) library that manages relationships between data, provides schema validation, and is used to create a connection between MongoDB and the Node.js runtime environment.<br></br>\n<h3 id=\"nodemon\"><a href=\"#nodemon\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>#Nodemon</h3>\n<br>\n<p>While installing our dependencies, <strong>nodemon</strong> was installed to the <strong>devDependencies</strong> section. Why? We really don't need this package in production, it's only useful while developing locally. Nodemon is a Node app wrapper that will watch for any file changes in our project and automatically restart our server.\n<br></br>\nWithout it, we will have to restart the server manually everytime we make changes to any file in our project folder. Yikes üòñ, that will be stressful!</p>\n<br>\n<p>Now, let's get our hands dirty with code...\n<br></br></p>\n<h3 id=\"start-coding\"><a href=\"#start-coding\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>#Start coding</h3>\n<br>\n<p>Create a <strong>server.js</strong> file in the project root folder. You can name the JS file anything, it doesn't matter. This will be the entry point to our app. To start coding, open the <strong>package.json</strong> file and edit it like so üëá: <br></br></p>\n<pre><code class=\"language-json\">{\n  \"name\": \"userapp\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"dev\": \"nodemon server.js\"\n  },\n  \"keywords\": [],\n   \"type\": \"module\",\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"express\": \"^4.18.2\",\n    \"mongoose\": \"^6.7.2\"\n  },\n  \"devDependencies\": {\n    \"nodemon\": \"^2.0.20\"\n  }\n}\n</code></pre>\n<br>\n<p>What changed? If you noticed, we add a new text <strong>\"type\": \"module\"</strong>. This is notify the package file that we will be using <strong>ES6</strong> syntax whenever we're importing a package in our code. <br></br></p>\n<p>We also added a script of <strong>\"dev\": \"nodemon server.js\"</strong>. This will spin up our server, watch for file changes and automatically restart the server for us. <br></br></p>\n<p>In <strong>server.js</strong>, write the following code:<br></br></p>\n<pre><code class=\"language-javascript\">/* Import express */\nimport express from \"express\";\n\n/* Initialize express import */\nconst app = express()\n\n/* Listen to server on a port */\nconst PORT = process.env.PORT || 3000\napp.listen(PORT, () => {\n    console.log(`it's alive on http://localhost:${PORT}`);\n})\n</code></pre>\n<br>\n<p>We imported the <strong>express</strong> package, stored and intialized it in a variable. The <strong>app</strong> variable will now give us access to all <strong>express</strong> has to offer. At the end of the code, we started listening to our server on a port. Now open your terminal again and run <strong>npm run dev</strong>, the name of the script we created in the <strong>package.json</strong> file. You should get the output below üëá:</p>\n<br>\n<pre><code class=\"language-javascript\">Dev.Adewale ~/mongodb $ npm run dev\n\n> userapp@1.0.0 dev\n> nodemon server.js\n\n[nodemon] 2.0.20\n[nodemon] to restart at any time, enter `rs`\n[nodemon] watching path(s): *.*\n[nodemon] watching extensions: js,mjs,json  \n[nodemon] starting `node server.js`\nit's alive on http://localhost:3000\n</code></pre>\n<br>\n<p>Now that our server is up and running, let's connect to our MongoDB database. But first, open up <strong>MongoDB Compass</strong> and grab your local database installation <strong>URI</strong>. Then, create a <strong>db.js</strong> file in the project root folder and make the following changes üëá:</p>\n<br>\n<pre><code class=\"language-javascript\">/* Import mongoose */\nimport mongoose from \"mongoose\";\n\n/* Store local MongoDB uri ending with your database name */\nconst uri = \"mongodb://localhost:27017/UserDB\" /* &#x3C;- Database name */\n\n/* Connect to DB */\nmongoose.connect(uri, {\n    useNewUrlParser: true\n})\n\n/* Store connection instance */\nconst db = mongoose.connection\n\n/* Callback function to let us know when we're connected */\ndb.once(\"open\", () => {\n    console.log(\"Connected to MongoDB!\");\n})\n\n/* Export the store connection instance */\nexport default db\n</code></pre>\n<br>\n<p>Now navigate back to the <strong>server.js</strong> file and import the <strong>db.js</strong> file at the top-level:</p>\n<br>\n<pre><code class=\"language-javascript\">/* Import database connection to MongoDB */\nimport db from \"./db.js\";\n</code></pre>\n<br>\n<p>Afterwards, you should see some additional changes in the terminal output like below üëá:</p>\n<br>\n<pre><code class=\"language-bash\">Dev.Adewale ~/mongodb $ npm run dev\n\n> userapp@1.0.0 dev\n> nodemon server.js\n\n[nodemon] 2.0.20\n[nodemon] to restart at any time, enter `rs`\n[nodemon] watching path(s): *.*\n[nodemon] watching extensions: js,mjs,json  \n[nodemon] starting `node server.js`\nit's alive on http://localhost:3000\nConnected to MongoDB!\n</code></pre>\n<br>\n<p>Next, we will be creating a model that will enforce the structure of user's data that will be stored in our database. Create a <strong>model</strong> folder in the project root folder and also create a <strong>User.js</strong> file inside it. Let's make some changes üëá:</p>\n<br>\n<pre><code class=\"language-javascript\">/* Import mongoose */\nimport mongoose from \"mongoose\";\n\n/* Create a schema */\nconst userSchema = new mongoose.Schema({\n  \n    email: {\n        type: String,\n        required: true\n    },\n\n    name: {\n        type: String,\n        required: true\n    },\n\n    phoneNumber: {\n        type: Number,\n        required: true\n    }\n\n})\n\n/* Export the model */\nexport default mongoose.model(\"Users\", userSchema)\n</code></pre>\n<br>\n<p>We also have to setup routes handler that will respond to our endpoints. First create a <strong>routes</strong> folder containing <strong>router.js</strong> file. Make changes to the <strong>router.js</strong> file like so üëá:</p>\n<br>\n<pre><code class=\"language-javascript\">/* Import express */\nimport express from 'express'\n\n/* Init express Router */\nconst Router = express.Router()\n\n/* Export the Router variable */\nexport default Router\n</code></pre>\n<br> \n<p>In the <strong>server.js</strong> file, we have to create a <strong>middleware</strong> that will intercept every request we're getting and redirect them to the <strong>router.js</strong> file where they will be handled üëá:</p>\n<br>\n<pre><code class=\"language-javascript\">/* Import express */\nimport express from \"express\";\n\n/* Import database connection to MongoDB */\nimport db from \"./db.js\";\n\n/* Import Router */\nimport Router from \"./routes/router.js\";\n\n/* Init express instance */\nconst app = express()\n\n/* MIDDLEWARE STARTS */\n\n/* Redirect requests to Router */\napp.use('/', Router)\n\n/* MIDDLEWARE ENDS */\n\n/* Listening to port */\nconst PORT = process.env.PORT || 3000\napp.listen(PORT, () => {\n    console.log(`it's alive on http://localhost:${PORT}`);\n})\n</code></pre>\n<br>\n<p>We can now proceed to setup every endpoints in the <strong>router.js</strong> file. The first endpoint is the <strong>GET</strong> method, import the <strong>model</strong> created earlier in the router file. Then it can be used to communicate with our MongoDB database üëá:</p>\n<br>\n<pre><code class=\"language-javascript\">/* Import mongoose schema */\nimport User from '../model/User.js'\n\n/* Get all method */\nRouter.get('/get', async (req, res) => {\n\n    const get = await User.find()\n    res.send(get)\n})\n</code></pre>\n<br>\n<p>Now find an <strong>API client</strong> to test our first endpoint, I recommend <strong>Postman</strong> or <strong>Insomnia</strong> if you prefer a desktop client. Paste in the <strong>localhost</strong> URL followed by the corresponding <strong>endpoint</strong>. It should look like so üëâ: <strong><a href=\"http://localhost:3000/get\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:3000/get</a></strong>.</p>\n<br>\n<p>Note that you're going to get an empty response for now because we have nothing in our database. Next, we're going to create a <strong>POST</strong> endpoint and fill our database with some documents.</p>\n<br>\n<p>Navigate back to <strong>router.js</strong> and setup the <strong>POST</strong> endpoint üëá:</p>\n<br>\n<pre><code class=\"language-javascript\">/* Post method */\nRouter.post('/add', async (req, res) => {\n\n    const addUser = new User({\n        email: req.body.email,\n        name: req.body.name,\n        phoneNumber: req.body.phoneNumber\n    })\n\n    await addUser.save()\n    res.send(addUser)\n})\n</code></pre>\n<br>\n<p>To test our post endpoint, open up any API client you're using and send a POST request. Check your <strong>MongoDB Compass</strong> afterwards and you should see a new <strong>Database name</strong> with a <strong>Collection</strong> containing the <strong>data</strong> you just sent.</p>\n<br>\n<p>The <strong>POST</strong> endpoint is up, what if we have to delete a user data? Let's continue by creating a <strong>DELETE</strong> endpoint in the <strong>router.js</strong> file üëá:</p>\n<br>\n<pre><code class=\"language-javascript\">/* Delete method */\nRouter.delete('/remove/:id', async (req, res) => {\n    \n    const remove = await User.deleteOne({_id: req.params.id})\n    res.send(remove)\n})\n</code></pre>\n<br>\n<p>The last endpoint we will be creating is the <strong>PATCH</strong> method, this will allow us to edit and update existing users data store in our database. Navigate back to the <strong>router.js</strong> file and make new changes üëá:</p>\n<br>\n<pre><code class=\"language-javascript\">/* Patch method */\nRouter.patch('/update/:id', async (req, res) => {\n    \n    const update = await User.findByIdAndUpdate(req.params.id, req.body, {new: true})\n    res.send(update)\n})\n</code></pre>\n<br>\n<p>Make sure to test if all endpoints is functional and working as expected in any API client of your choice. If you have any questions or you're getting an error, be sure to comment. I will try to give a valid response as soon as I can. Bye for now üôã‚Äç‚ôÇÔ∏è!</p>\n","tags":[{"id":"backend","title":"backend","path":"/tag/backend/"},{"id":"api","title":"api","path":"/tag/api/"}]}},"context":{}}